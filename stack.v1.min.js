function stack(){function e(e,t){var n=v[0][t],a=e.sourceEvent=d3.event;try{d3.event=e,r[e.type].call(n,n.__data__,t)}finally{d3.event=a}}function t(){if(s)var e=p;s=c[1]/c[0]*innerWidth,l=innerHeight,h.style("top",(l-s)/2+"px").style("height",s+"px"),b.style("top",function(e){return(e+(1-u)/2)*l+"px"}).style("height",l*u+"px"),x.style("font-size",innerWidth/c[0]*d+"px").style("height",l*k+"px"),isNaN(e)||scrollTo(0,(p=e)*l)}function n(){var t=pageYOffset/l,n=Math.max(0,Math.min(k-1,Math.floor(t)));y!==n&&(n===y+1?(g.style("display","none"),g=m,m=d3.select(v[0][n+1]),e({type:"deactivate"},y),e({type:"activate"},n+1)):n===y-1?(m.style("display","none"),m=g,g=d3.select(v[0][n]),e({type:"deactivate"},y+1),e({type:"activate"},n)):(g.style("display","none"),m.style("display","none"),g=d3.select(v[0][n]),m=d3.select(v[0][n+1]),isNaN(y)||(e({type:"deactivate"},y+1),e({type:"deactivate"},y)),e({type:"activate"},n),e({type:"activate"},n+1)),g.style("display","block").style("opacity",1),m.style("display","block"),y=n),t-n>(1-u)/2?m.style("display","block").style("opacity",Math.min(1,(t-n-(1-u)/2)/u)):m.style("display","none"),e({type:"scroll",offset:p=t},y)}function a(){var e;switch(d3.event.keyCode){case 39:if(d3.event.metaKey)return;case 40:case 34:e=d3.event.metaKey?1/0:1;break;case 37:if(d3.event.metaKey)return;case 38:case 33:e=d3.event.metaKey?-1/0:-1;break;case 32:e=d3.event.shiftKey?-1:1;break;default:return}var t=isNaN(i)?p:i;i=Math.max(0,Math.min(k-1,(e>0?Math.floor(t+(1-u)/2):Math.ceil(t-(1-u)/2))+e)),d3.select(document.documentElement).interrupt().transition().duration(500).tween("scroll",function(){var e=d3.interpolateNumber(pageYOffset,i*l);return function(t){scrollTo(0,e(t))}}).each("end",function(){i=0/0}),d3.event.preventDefault()}var s,l,i,o={},c=[1280,720],d=32,r=d3.dispatch("scroll","activate","deactivate"),y=0/0,p=0,u=.25,f=d3.select("body").insert("div","section").style("box-shadow","0 8px 16px rgba(0,0,0,.3)"),v=d3.selectAll("section").style("display","none").style("box-sizing","border-box").style("line-height","1.35em"),h=d3.selectAll(v[0].concat(f.node())).style("position","fixed").style("left",0).style("top",0).style("width","100%"),b=d3.select("body").append("div").attr("class","indicator").selectAll("div").data(d3.range(v.size())).enter().append("div").style("position","absolute").style("left",0).style("width","3px").style("background","linear-gradient(to top,transparent,white)"),g=d3.select(v[0][0]).style("display","block"),m=d3.select(v[0][1]).style("display","block"),k=v.size(),x=d3.select("body").style("margin",0).style("padding",0).style("background","#333");return d3.select(window).on("resize.stack",t).on("scroll.stack",n).on("keydown.stack",a).each(t),d3.timer(function(){return n(),!0}),o.size=function(e){return arguments.length?(c=[+e[0],+e[1]],t(),o):c},o.scrollRatio=function(e){return arguments.length?(u=+e,t(),o):u},o.fontSize=function(e){return arguments.length?(d=+e,t(),o):d},d3.rebind(o,r,"on"),o}