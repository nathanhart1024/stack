function stack(){function e(){if(n)var e=r;n=i[1]/i[0]*innerWidth,h.style("top",(innerHeight-n)/2+"px").style("height",n+"px"),f.style("margin-top",(innerHeight-n)/2+"px").style("top",function(e){return(e+(1-y)/2)*n+"px"}).style("height",n*y+"px"),m.style("font-size",innerWidth/i[0]*c+"px").style("height",n*b+(innerHeight-n)+"px"),isNaN(e)&&scrollTo(0,(r=e)*n)}function t(){var e=pageYOffset/n,t=Math.max(0,Math.min(b-1,Math.floor(e)));d!==t&&(t===d+1?(v.style("display","none"),v=g,g=d3.select(u[0][t+1]),o.deactivate.call(s,d),o.activate.call(s,t+1)):t===d-1?(g.style("display","none"),g=v,v=d3.select(u[0][t]),o.deactivate.call(s,d+1),o.activate.call(s,t)):(v.style("display","none"),g.style("display","none"),v=d3.select(u[0][t]),g=d3.select(u[0][t+1]),isNaN(d)||(o.deactivate.call(s,d+1),o.deactivate.call(s,d)),o.activate.call(s,t),o.activate.call(s,t+1)),v.style("display","block").style("opacity",1),g.style("display","block"),d=t),e-t>(1-y)/2?g.style("display","block").style("opacity",Math.min(1,(e-t-(1-y)/2)/y)):g.style("display","none"),o.scroll.call(s,r=e)}function l(){var e;switch(d3.event.keyCode){case 39:if(d3.event.metaKey)return;case 40:case 34:e=d3.event.metaKey?1/0:1;break;case 37:if(d3.event.metaKey)return;case 38:case 33:e=d3.event.metaKey?-1/0:-1;break;case 32:e=d3.event.shiftKey?-1:1;break;default:return}var t=isNaN(a)?r:a;a=Math.max(0,Math.min(b-1,(e>0?Math.floor(t+(1-y)/2):Math.ceil(t-(1-y)/2))+e)),d3.select(document.documentElement).interrupt().transition().duration(500).tween("scroll",function(){var e=d3.interpolateNumber(pageYOffset,a*n);return function(t){scrollTo(0,e(t))}}).each("end",function(){a=0/0}),d3.event.preventDefault()}var n,a,s={},i=[1280,720],c=32,o=d3.dispatch("scroll","activate","deactivate"),d=0/0,r=0,y=.25,p=d3.select("body").insert("div","section").style("box-shadow","0 8px 16px rgba(0,0,0,.3)"),u=d3.selectAll("section").style("display","none").style("box-sizing","border-box").style("line-height","1.35em"),h=d3.selectAll(u[0].concat(p.node())).style("position","fixed").style("left",0).style("top",0).style("width","100%"),f=d3.select("body").append("div").attr("class","indicator").selectAll("div").data(d3.range(u.size())).enter().append("div").style("position","absolute").style("left",0).style("width","3px").style("background","linear-gradient(to top,transparent,white)"),v=d3.select(u[0][0]).style("display","block"),g=d3.select(u[0][1]).style("display","block"),b=u.size(),m=d3.select("body").style("margin",0).style("padding",0).style("background","#333");return d3.select(window).on("resize.stack",e).on("scroll.stack",t).on("keydown.stack",l).each(e),d3.timer(function(){return t(),!0}),s.size=function(t){return arguments.length?(i=[+t[0],+t[1]],e(),s):i},s.scrollRatio=function(t){return arguments.length?(y=+t,e(),s):y},s.fontSize=function(t){return arguments.length?(c=+t,e(),s):c},d3.rebind(s,o,"on"),s}