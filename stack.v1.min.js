function stack(){function e(){if(a)var e=y;a=c[1]/c[0]*innerWidth,n=innerHeight,f.style("top",(n-a)/2+"px").style("height",a+"px"),v.style("top",function(e){return(e+(1-p)/2)*n+"px"}).style("height",n*p+"px"),k.style("font-size",innerWidth/c[0]*o+"px").style("height",n*m+"px"),isNaN(e)||scrollTo(0,(y=e)*n)}function t(){var e=pageYOffset/n,t=Math.max(0,Math.min(m-1,Math.floor(e)));r!==t&&(t===r+1?(b.style("display","none"),b=g,g=d3.select(h[0][t+1]),d.deactivate.call(i,r),d.activate.call(i,t+1)):t===r-1?(g.style("display","none"),g=b,b=d3.select(h[0][t]),d.deactivate.call(i,r+1),d.activate.call(i,t)):(b.style("display","none"),g.style("display","none"),b=d3.select(h[0][t]),g=d3.select(h[0][t+1]),isNaN(r)||(d.deactivate.call(i,r+1),d.deactivate.call(i,r)),d.activate.call(i,t),d.activate.call(i,t+1)),b.style("display","block").style("opacity",1),g.style("display","block"),r=t),e-t>(1-p)/2?g.style("display","block").style("opacity",Math.min(1,(e-t-(1-p)/2)/p)):g.style("display","none"),d.scroll.call(i,y=e)}function l(){var e;switch(d3.event.keyCode){case 39:if(d3.event.metaKey)return;case 40:case 34:e=d3.event.metaKey?1/0:1;break;case 37:if(d3.event.metaKey)return;case 38:case 33:e=d3.event.metaKey?-1/0:-1;break;case 32:e=d3.event.shiftKey?-1:1;break;default:return}var t=isNaN(s)?y:s;s=Math.max(0,Math.min(m-1,(e>0?Math.floor(t+(1-p)/2):Math.ceil(t-(1-p)/2))+e)),d3.select(document.documentElement).interrupt().transition().duration(500).tween("scroll",function(){var e=d3.interpolateNumber(pageYOffset,s*n);return function(t){scrollTo(0,e(t))}}).each("end",function(){s=0/0}),d3.event.preventDefault()}var a,n,s,i={},c=[1280,720],o=32,d=d3.dispatch("scroll","activate","deactivate"),r=0/0,y=0,p=.25,u=d3.select("body").insert("div","section").style("box-shadow","0 8px 16px rgba(0,0,0,.3)"),h=d3.selectAll("section").style("display","none").style("box-sizing","border-box").style("line-height","1.35em"),f=d3.selectAll(h[0].concat(u.node())).style("position","fixed").style("left",0).style("top",0).style("width","100%"),v=d3.select("body").append("div").attr("class","indicator").selectAll("div").data(d3.range(h.size())).enter().append("div").style("position","absolute").style("left",0).style("width","3px").style("background","linear-gradient(to top,transparent,white)"),b=d3.select(h[0][0]).style("display","block"),g=d3.select(h[0][1]).style("display","block"),m=h.size(),k=d3.select("body").style("margin",0).style("padding",0).style("background","#333");return d3.select(window).on("resize.stack",e).on("scroll.stack",t).on("keydown.stack",l).each(e),d3.timer(function(){return t(),!0}),i.size=function(t){return arguments.length?(c=[+t[0],+t[1]],e(),i):c},i.scrollRatio=function(t){return arguments.length?(p=+t,e(),i):p},i.fontSize=function(t){return arguments.length?(o=+t,e(),i):o},d3.rebind(i,d,"on"),i}