function stack(){function e(e,t){var n=x[0][t],i=e.sourceEvent=d3.event;try{d3.event=e,d[e.type].call(n,n.__data__,t)}finally{d3.event=i}}function t(){var e=20;l=y[1]/y[0]*innerWidth,a=innerHeight,x.style("height",l+"px").style("box-shadow","0 4px 4px rgba(0,0,0,.3)").filter(function(e,t){return b-1>t}).style("margin-bottom",e+"px"),g.style("font-size",innerWidth/y[0]*c+"px")}function n(){if(l)var e=h;l=y[1]/y[0]*innerWidth,a=innerHeight,z.style("top",(a-l)/2+"px").style("height",l+"px"),k.style("top",function(e){return(e+(1-v)/2)*a+"px"}).style("height",a*v+"px"),g.style("font-size",innerWidth/y[0]*c+"px").style("height",a*b+"px"),isNaN(e)||scrollTo(0,(h=e)*a)}function i(){var t=pageYOffset/a,n=Math.max(0,Math.min(b-1,Math.floor(t+(1+v)/2)));f!==n&&(n===f+1?(w.interrupt().style("display","none"),w=M.interrupt().style("opacity",1).style("z-index",0),M=N.interrupt().style("opacity",0).style("z-index",1),M.transition().style("opacity",1),N=d3.select(x[0][n+1]).interrupt().style("display","block").style("opacity",0).style("z-index",0),e({type:"deactivate"},f),b-1>n&&e({type:"activate"},n+1)):n===f-1?(N.interrupt().style("display","none"),N=M.interrupt().style("opacity",1).style("z-index",0),M=w.interrupt().style("opacity",0).style("z-index",1),M.transition().style("opacity",1),w=d3.select(x[0][n-1]).interrupt().style("display","block").style("opacity",0).style("z-index",0),b-1>f&&e({type:"deactivate"},f+1),e({type:"activate"},n)):(w.style("display","none"),M.style("display","none"),N.style("display","none"),w=d3.select(x[0][n-1]).interrupt().style("display","block").style("opacity",0).style("z-index",0),M=d3.select(x[0][n]).interrupt().style("display","block").style("opacity",1).style("z-index",1),N=d3.select(x[0][n+1]).interrupt().style("display","block").style("opacity",0).style("z-index",0),isNaN(f)||(e({type:"deactivate"},f+1),e({type:"deactivate"},f)),e({type:"activate"},n),b-1>n&&e({type:"activate"},n+1)),f=n),e({type:"scroll",offset:h=t},f)}function s(){var e;switch(d3.event.keyCode){case 39:if(d3.event.metaKey)return;case 40:case 34:e=d3.event.metaKey?1/0:1;break;case 37:if(d3.event.metaKey)return;case 38:case 33:e=d3.event.metaKey?-1/0:-1;break;case 32:e=d3.event.shiftKey?-1:1;break;default:return}var t=isNaN(r)?h:r;r=Math.max(0,Math.min(b-1,(e>0?Math.floor(t+(1+v)/2):Math.ceil(t-(1-v)/2))+e)),d3.select(document.documentElement).interrupt().transition().duration(500).tween("scroll",function(){var e=d3.interpolateNumber(pageYOffset,r*a);return function(t){scrollTo(0,e(t))}}).each("end",function(){r=0/0}),d3.event.preventDefault()}var l,a,r,o={},y=[1280,720],c=32,d=d3.dispatch("scroll","activate","deactivate"),p="ontouchstart"in document,u=p?t:n,f=0/0,h=0,v=1/6,x=d3.selectAll("section").style("box-sizing","border-box").style("line-height","1.35em"),b=x.size(),g=d3.select("body").style("margin",0).style("padding",0).style("background","#333");if(p)x.style("position","relative"),d3.select(window).on("resize.stack",u).each(u);else{var m=d3.select("body").insert("div","section").style("background","#000").style("box-shadow","0 8px 16px rgba(0,0,0,.3)");x.style("display","none").style("opacity",0).style("z-index",0);var z=d3.selectAll(x[0].concat(m.node())).style("position","fixed").style("left",0).style("top",0).style("width","100%"),k=d3.select("body").append("div").attr("class","indicator").selectAll("div").data(d3.range(x.size())).enter().append("div").style("position","absolute").style("z-index",2).style("left",0).style("width","3px").style("background","linear-gradient(to top,black,white)"),w=d3.select(null),M=d3.select(x[0][0]),N=d3.select(x[0][1]);d3.select(window).on("resize.stack",u).on("scroll.stack",i).on("keydown.stack",s).each(u),d3.timer(function(){return i(),!0})}return o.size=function(e){return arguments.length?(y=[+e[0],+e[1]],u(),o):y},o.scrollRatio=function(e){return arguments.length?(v=+e,u(),o):v},o.fontSize=function(e){return arguments.length?(c=+e,u(),o):c},d3.rebind(o,d,"on"),o}